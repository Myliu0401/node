![](http://mdrs.yuanjin.tech/img/node组成原理图.jpg)


根据原理图来: 

                    蓝色区域代表js写的,黑色箭头表示调用

                    橙色区域代表c/c++写的,橙色箭头表示交付

                    绿色箭头表示扩展 --- 扩展进去V8引擎

                    黑色区域代表操作系统的api

1. 用户代码

JS代码，开发者编写的



2. 第三方库

大部分仍然是JS代码，由其他开发者编写



3. 本地模块代码

JS代码



4. V8引擎

c/c++代码，作用：把JS代码解释成为机器码

可以通过v8引擎的某种机制，扩展其功能。
v8引擎提供了一个扩展功能,v8引擎是c/c++写的,所以扩展的代码也必须是c/c++写的,会将扩展功能编译进去v8引擎中。
比如:浏览器将dom、ajax、事件、等等扩展进去v8引擎。执行时 页面的js 代码交付给浏览器的v8引擎来解析,就是为什么有dom等等不会报错,因为已经被扩展进去。

在node中,会将本地模块编译成c/c++代码,然后跟内置模块一起组装编译,然后扩展到v8引擎中,只就是为什么用户代码调用不了内置模块,只能调用本地模块,让本地模块去调用内置模块。

内置模块会根据不同的操作系统根据不同的接口来调用操作系统的api,等等所以会将和本地模块一起组装编译后,扩展到v8引擎中,但只能靠本地模块来调用这些。

V8引擎的扩展和对扩展的编译，是通过一个工具：gyp工具

某些第三方库需要使用`node-gyp`工具进行构建，因此需要先安装`node-gyp`

